# –≠—Ç–∞–ø 1 - –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `user_sources` –≤ Supabase –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è —Å –≤—ã–±–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏—è
‚úÖ –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/start`
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
‚úÖ –ü–µ—Ä–µ–º–µ—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è "–í –ë–∞–∑—É"
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ –ë–î

## üéØ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start
         ‚Üì
üíæ –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ (user_sources)
         ‚Üì
üì± –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω:
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  üëã –ü—Ä–∏–≤–µ—Ç, [–ò–º—è]!                      ‚îÇ
   ‚îÇ                                          ‚îÇ
   ‚îÇ  –†–∞–¥ –≤–∏–¥–µ—Ç—å —Ç–µ–±—è –≤ –±–∞–∑–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞      ‚îÇ
   ‚îÇ  ¬´–ì–æ–ª–æ—Å –°—Ç—Ä–æ–π–∫–∏¬ª.                        ‚îÇ
   ‚îÇ                                          ‚îÇ
   ‚îÇ  üîπ –°—é–¥–∞ –º–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è...         ‚îÇ
   ‚îÇ  üîπ –ó–¥–µ—Å—å —è –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏...              ‚îÇ
   ‚îÇ                                          ‚îÇ
   ‚îÇ  –ß—Ç–æ –≤—ã–±–∏—Ä–∞–µ—à—å?                          ‚îÇ
   ‚îÇ                                          ‚îÇ
   ‚îÇ  [üë• –í —Å–æ–æ–±—â–µ—Å—Ç–≤–æ ¬´–ì–æ–ª–æ—Å –°—Ç—Ä–æ–π–∫–∏¬ª]       ‚îÇ
   ‚îÇ  [üóÇ –í –ë–∞–∑—É]                             ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì                    ‚Üì
         ‚îÇ                    ‚îÇ
    –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è          –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
       –∫–∞–Ω–∞–ª                   ‚Üì
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ                   ‚îÇ
                    –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω          –ü–æ–¥–ø–∏—Å–∞–Ω
                          ‚Üì                   ‚Üì
              –ü—Ä–æ—Å—å–±–∞ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è      –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
              + –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã user_sources

| –ü–æ–ª–µ        | –¢–∏–ø       | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|-------------|-----------|---------------------------------------------|
| id          | BIGSERIAL | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á                              |
| telegram_id | BIGINT    | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)     |
| source      | VARCHAR   | –ò—Å—Ç–æ—á–Ω–∏–∫: –∏–Ω—Å—Ç–∞/—Ç–∏–∫—Ç–æ–∫/—é—Ç—É–±/—Å—Ç–∞—Ç—å–∏/–¥—Ä—É–≥–æ–µ  |
| created_at  | TIMESTAMP | –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è                 |

## üîë –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –ù–æ–≤–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
```javascript
const welcomeScreenKeyboard = {
  reply_markup: {
    inline_keyboard: [
      [{ text: 'üë• –í —Å–æ–æ–±—â–µ—Å—Ç–≤–æ ¬´–ì–æ–ª–æ—Å –°—Ç—Ä–æ–π–∫–∏¬ª', url: '...' }],
      [{ text: 'üóÇ –í –ë–∞–∑—É', callback_data: 'go_to_database' }]
    ]
  }
};
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π /start
```javascript
bot.onText(/\/start/, async (msg) => {
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞
  await saveUserSource(userId, '–¥—Ä—É–≥–æ–µ');

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
  await showWelcomeScreen(chatId, msg.from.first_name);
});
```

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–í –ë–∞–∑—É"
```javascript
if (data === 'go_to_database') {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
  const isSubscribed = await checkSubscription(userId);

  if (!isSubscribed) {
    // –°–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ—Å—å–±–æ–π –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è
  } else {
    // –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    await showMainMenu(chatId);
  }
}
```

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –∑–∞–ø—É—Å–∫–∞

1. **–í Supabase:**
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∏–∑ `database-user-sources.sql`

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**
   ```bash
   node bot.js
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å /start –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ user_sources
   - –ù–∞–∂–∞—Ç—å "–í –ë–∞–∑—É" –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏
   - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –∏ –Ω–∞–∂–∞—Ç—å "–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ /start –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:
  ```
  /start?source=instagram
  /start?source=tiktok
  /start?ref=article_123
  ```

- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ç—Ä–∞—Ñ–∏–∫–∞:
  - –¢–æ–ø –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
  - –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
  - –î–∏–Ω–∞–º–∏–∫–∞ –ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ (–æ–¥–∏–Ω user = –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å)
- –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º "–¥—Ä—É–≥–æ–µ"
- –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ user_sources –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ö–Ω–æ–ø–∫–∞ "–í —Å–æ–æ–±—â–µ—Å—Ç–≤–æ" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–æ—Ç–∞)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –¥–µ–ø–ª–æ—é
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-XX
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –≠—Ç–∞–ø 2 (TBD)
